(self.webpackChunkslippi_wrapped=self.webpackChunkslippi_wrapped||[]).push([[782],{669:(t,e,n)=>{"use strict";var s,r=n(4656),a=n(4512),o=n(3928),i=n(9278),l=n(1678),c=n(4978);!function(t){t[t.DAMAGE_START=75]="DAMAGE_START",t[t.DAMAGE_END=91]="DAMAGE_END",t[t.CAPTURE_START=223]="CAPTURE_START",t[t.CAPTURE_END=232]="CAPTURE_END",t[t.GUARD_START=178]="GUARD_START",t[t.GUARD_END=182]="GUARD_END",t[t.GROUNDED_CONTROL_START=14]="GROUNDED_CONTROL_START",t[t.GROUNDED_CONTROL_END=24]="GROUNDED_CONTROL_END",t[t.SQUAT_START=39]="SQUAT_START",t[t.SQUAT_END=41]="SQUAT_END",t[t.DOWN_START=183]="DOWN_START",t[t.DOWN_END=198]="DOWN_END",t[t.TECH_START=199]="TECH_START",t[t.TECH_END=204]="TECH_END",t[t.DYING_START=0]="DYING_START",t[t.DYING_END=10]="DYING_END",t[t.CONTROLLED_JUMP_START=24]="CONTROLLED_JUMP_START",t[t.CONTROLLED_JUMP_END=34]="CONTROLLED_JUMP_END",t[t.GROUND_ATTACK_START=44]="GROUND_ATTACK_START",t[t.GROUND_ATTACK_END=64]="GROUND_ATTACK_END",t[t.AERIAL_ATTACK_START=65]="AERIAL_ATTACK_START",t[t.AERIAL_ATTACK_END=74]="AERIAL_ATTACK_END",t[t.ROLL_FORWARD=233]="ROLL_FORWARD",t[t.ROLL_BACKWARD=234]="ROLL_BACKWARD",t[t.SPOT_DODGE=235]="SPOT_DODGE",t[t.AIR_DODGE=236]="AIR_DODGE",t[t.ACTION_WAIT=14]="ACTION_WAIT",t[t.ACTION_DASH=20]="ACTION_DASH",t[t.ACTION_KNEE_BEND=24]="ACTION_KNEE_BEND",t[t.GUARD_ON=178]="GUARD_ON",t[t.TECH_MISS_UP=183]="TECH_MISS_UP",t[t.TECH_MISS_DOWN=191]="TECH_MISS_DOWN",t[t.NEUTRAL_TECH=199]="NEUTRAL_TECH",t[t.FORWARD_TECH=200]="FORWARD_TECH",t[t.BACKWARD_TECH=201]="BACKWARD_TECH",t[t.WALL_TECH=202]="WALL_TECH",t[t.MISSED_WALL_TECH=247]="MISSED_WALL_TECH",t[t.DASH=20]="DASH",t[t.TURN=18]="TURN",t[t.LANDING_FALL_SPECIAL=43]="LANDING_FALL_SPECIAL",t[t.JUMP_FORWARD=25]="JUMP_FORWARD",t[t.JUMP_BACKWARD=26]="JUMP_BACKWARD",t[t.FALL_FORWARD=30]="FALL_FORWARD",t[t.FALL_BACKWARD=31]="FALL_BACKWARD",t[t.GRAB=212]="GRAB",t[t.GRAB_WAIT=216]="GRAB_WAIT",t[t.PUMMEL=217]="PUMMEL",t[t.CLIFF_CATCH=252]="CLIFF_CATCH",t[t.THROW_UP=221]="THROW_UP",t[t.THROW_FORWARD=219]="THROW_FORWARD",t[t.THROW_DOWN=222]="THROW_DOWN",t[t.THROW_BACK=220]="THROW_BACK",t[t.DAMAGE_FALL=38]="DAMAGE_FALL",t[t.BARREL_WAIT=293]="BARREL_WAIT",t[t.COMMAND_GRAB_RANGE1_START=266]="COMMAND_GRAB_RANGE1_START",t[t.COMMAND_GRAB_RANGE1_END=304]="COMMAND_GRAB_RANGE1_END",t[t.COMMAND_GRAB_RANGE2_START=327]="COMMAND_GRAB_RANGE2_START",t[t.COMMAND_GRAB_RANGE2_END=338]="COMMAND_GRAB_RANGE2_END"}(s||(s={}));const u=45,h=45;function p(t){return t&&2===t.players.length?[{playerIndex:t.players[0].playerIndex,opponentIndex:t.players[1].playerIndex},{playerIndex:t.players[1].playerIndex,opponentIndex:t.players[0].playerIndex}]:[]}function A(t,e){return!(!t||!e)&&e.stocksRemaining-t.stocksRemaining>0}function m(t){return t>=s.DAMAGE_START&&t<=s.DAMAGE_END||t===s.DAMAGE_FALL}function d(t){return t>=s.CAPTURE_START&&t<=s.CAPTURE_END}function _(t){return(t>=s.COMMAND_GRAB_RANGE1_START&&t<=s.COMMAND_GRAB_RANGE1_END||t>=s.COMMAND_GRAB_RANGE2_START&&t<=s.COMMAND_GRAB_RANGE2_END)&&t!==s.BARREL_WAIT}function E(t){return t>=s.DYING_START&&t<=s.DYING_END}function f(t,e){var n,s;return(null!=(n=t.percent)?n:0)-(null!=(s=e.percent)?s:0)}const T=[s.DASH,s.TURN,s.DASH];class C{constructor(){this.playerPermutations=new Array,this.state=new Map}setup(t){this.state=new Map,this.playerPermutations=p(t),this.playerPermutations.forEach(t=>{const e={playerCounts:{playerIndex:t.playerIndex,wavedashCount:0,wavelandCount:0,airDodgeCount:0,dashDanceCount:0,spotDodgeCount:0,ledgegrabCount:0,rollCount:0,lCancelCount:{success:0,fail:0},grabCount:{success:0,fail:0},throwCount:{up:0,forward:0,back:0,down:0},groundTechCount:{away:0,in:0,neutral:0,fail:0},wallTechCount:{success:0,fail:0}},animations:[]};this.state.set(t,e)})}processFrame(t){this.playerPermutations.forEach(e=>{const n=this.state.get(e);n&&function(t,e,n){const u=n.players[e.playerIndex].post,h=n.players[e.opponentIndex].post,p=(e,n)=>{if(!n)return;const s=(0,r.A)(t.playerCounts,e,0);(0,a.A)(t.playerCounts,e,s+1)},A=u.actionStateId;t.animations.push(A);const m=t.animations.slice(-3),d=m[m.length-2],_=A!==d,E=(0,o.A)(m,T);p("dashDanceCount",E);const f=function(t,e){const n=R(t),s=R(e);return n&&!s}(A,d);p("rollCount",f);const C=function(t,e){const n=I(t),s=I(e);return n&&!s}(A,d);p("spotDodgeCount",C);const y=function(t,e){const n=g(t),s=g(e);return n&&!s}(A,d);p("airDodgeCount",y);const F=function(t,e){const n=D(t),s=D(e);return n&&!s}(A,d);p("ledgegrabCount",F);const S=function(t,e){return e===s.GRAB&&t<=s.GRAB_WAIT&&t>s.GRAB}(A,d);p("grabCount.success",S);const N=function(t,e){return e===s.GRAB&&(t>s.GRAB_WAIT||t<s.GRAB)}(A,d);if(p("grabCount.fail",N),p("throwCount.up",A===s.THROW_UP&&_),p("throwCount.forward",A===s.THROW_FORWARD&&_),p("throwCount.down",A===s.THROW_DOWN&&_),p("throwCount.back",A===s.THROW_BACK&&_),_){p("groundTechCount.fail",(O=A)===s.TECH_MISS_DOWN||O===s.TECH_MISS_UP);let t=1,e=!1;u.positionX>h.positionX&&(t=-1),u.facingDirection==t&&(e=!0),p("groundTechCount.in",A===s.FORWARD_TECH&&e),p("groundTechCount.in",A===s.BACKWARD_TECH&&!e),p("groundTechCount.neutral",A===s.NEUTRAL_TECH),p("groundTechCount.away",A===s.BACKWARD_TECH&&e),p("groundTechCount.away",A===s.FORWARD_TECH&&!e),p("wallTechCount.success",A===s.WALL_TECH),p("wallTechCount.fail",A===s.MISSED_WALL_TECH)}var O;(function(t){return t>=s.AERIAL_ATTACK_START&&t<=s.AERIAL_ATTACK_END})(A)&&(p("lCancelCount.success",1===u.lCancelStatus),p("lCancelCount.fail",2===u.lCancelStatus));!function(t,e){const n=(0,i.A)(e),r=e[e.length-2],a=n===s.LANDING_FALL_SPECIAL,o=function(t){if(t===s.AIR_DODGE)return!0;const e=t>=s.CONTROLLED_JUMP_START,n=t<=s.CONTROLLED_JUMP_END;return e&&n}(r);if(!a||!o)return;const u=e.slice(-8),h=(0,l.A)(u,t=>t);if(2===(0,c.A)(h)&&h[s.AIR_DODGE])return;h[s.AIR_DODGE]&&(t.airDodgeCount-=1);h[s.ACTION_KNEE_BEND]?t.wavedashCount+=1:t.wavelandCount+=1}(t.playerCounts,t.animations)}(n,e,t)})}fetch(){return Array.from(this.state.values()).map(t=>t.playerCounts)}}function R(t){return t===s.ROLL_BACKWARD||t===s.ROLL_FORWARD}function I(t){return t===s.SPOT_DODGE}function g(t){return t===s.AIR_DODGE}function D(t){return t===s.CLIFF_CATCH}var y,F=n(3308);!function(t){t.COMBO_START="COMBO_START",t.COMBO_EXTEND="COMBO_EXTEND",t.COMBO_END="COMBO_END"}(y||(y={}));class S extends F.EventEmitter{constructor(){super(...arguments),this.playerPermutations=new Array,this.state=new Map,this.combos=new Array,this.settings=null}setup(t){this.settings=t,this.state=new Map,this.combos=[],this.playerPermutations=p(t),this.playerPermutations.forEach(t=>{this.state.set(t,{combo:null,move:null,resetCounter:0,lastHitAnimation:null,event:null})})}processFrame(t,e){this.playerPermutations.forEach(n=>{const r=this.state.get(n);r&&(!function(t,e,n,r,a){const o=r.frame,i=r.players[n.playerIndex].post,l=r.players[n.opponentIndex].post,c=o-1;let u=null,p=null;t[c]&&(u=t[c].players[n.playerIndex].post,p=t[c].players[n.opponentIndex].post);const T=l.actionStateId,C=m(T),R=d(T),I=_(T),g=p?f(l,p):0,D=i.actionStateId!==e.lastHitAnimation,F=i.actionStateCounter,S=u?u.actionStateCounter:0,N=F<S;(D||N)&&(e.lastHitAnimation=null);if(C||R||I){let t=!1;var O,L;if(!e.combo)e.combo={playerIndex:n.opponentIndex,startFrame:o,endFrame:null,startPercent:p&&null!=(O=p.percent)?O:0,currentPercent:null!=(L=l.percent)?L:0,endPercent:null,moves:[],didKill:!1,lastHitBy:n.playerIndex},a.push(e.combo),t=!0;g&&(null===e.lastHitAnimation&&(e.move={playerIndex:n.playerIndex,frame:o,moveId:i.lastAttackLanded,hitCount:0,damage:0},e.combo.moves.push(e.move),t||(e.event=y.COMBO_EXTEND)),e.move&&(e.move.hitCount+=1,e.move.damage+=g),e.lastHitAnimation=u?u.actionStateId:null),t&&(e.event=y.COMBO_START)}if(!e.combo)return;const P=function(t){return t>=s.TECH_START&&t<=s.TECH_END}(T),M=function(t){return t>=s.DOWN_START&&t<=s.DOWN_END}(T),v=p&&A(l,p),k=E(T);var G;v||(e.combo.currentPercent=null!=(G=l.percent)?G:0);C||R||I||P||M||k?e.resetCounter=0:e.resetCounter+=1;let b=!1;v&&(e.combo.didKill=!0,b=!0);e.resetCounter>h&&(b=!0);if(b){var w;e.combo.endFrame=i.frame,e.combo.endPercent=p&&null!=(w=p.percent)?w:0,e.event=y.COMBO_END,e.combo=null,e.move=null}}(e,r,n,t,this.combos),null!==r.event&&(this.emit(r.event,{combo:(0,i.A)(this.combos),settings:this.settings}),r.event=null))})}fetch(){return this.combos}}var N,O,L,P,M=n(1754),v=n(5086),k=n(5299);class G extends F.EventEmitter{constructor(){super(),this.playerPermutations=new Array,this.conversions=new Array,this.state=new Map,this.metadata=void 0,this.settings=null,this.metadata={lastEndFrameByOppIdx:{}}}setup(t){this.playerPermutations=p(t),this.conversions=[],this.state=new Map,this.metadata={lastEndFrameByOppIdx:{}},this.settings=t,this.playerPermutations.forEach(t=>{this.state.set(t,{conversion:null,move:null,resetCounter:0,lastHitAnimation:null})})}processFrame(t,e){this.playerPermutations.forEach(n=>{const r=this.state.get(n);if(r){const a=function(t,e,n,r,a){const o=r.frame,i=r.players[n.playerIndex].post,l=r.players[n.opponentIndex].post,c=o-1;let h=null,p=null;t[c]&&(h=t[c].players[n.playerIndex].post,p=t[c].players[n.opponentIndex].post);const E=l.actionStateId,T=m(E),C=d(E),R=_(E),I=p?f(l,p):0,g=i.actionStateId!==e.lastHitAnimation,D=i.actionStateCounter,y=h?h.actionStateCounter:0,F=D<y;(g||F)&&(e.lastHitAnimation=null);if(T||C||R){var S,N;if(!e.conversion)e.conversion={playerIndex:n.opponentIndex,lastHitBy:n.playerIndex,startFrame:o,endFrame:null,startPercent:p&&null!=(S=p.percent)?S:0,currentPercent:null!=(N=l.percent)?N:0,endPercent:null,moves:[],didKill:!1,openingType:"unknown"},a.push(e.conversion);I&&(null===e.lastHitAnimation&&(e.move={playerIndex:n.playerIndex,frame:o,moveId:i.lastAttackLanded,hitCount:0,damage:0},e.conversion.moves.push(e.move)),e.move&&(e.move.hitCount+=1,e.move.damage+=I),e.lastHitAnimation=h?h.actionStateId:null)}if(!e.conversion)return!1;const O=function(t){const e=t>=s.GROUNDED_CONTROL_START&&t<=s.GROUNDED_CONTROL_END,n=t>=s.SQUAT_START&&t<=s.SQUAT_END,r=t>s.GROUND_ATTACK_START&&t<=s.GROUND_ATTACK_END,a=t===s.GRAB;return e||n||r||a}(E),L=p&&A(l,p);var P;L||(e.conversion.currentPercent=null!=(P=l.percent)?P:0);(T||C||R)&&(e.resetCounter=0);const M=0===e.resetCounter&&O,v=e.resetCounter>0;(M||v)&&(e.resetCounter+=1);let k=!1;L&&(e.conversion.didKill=!0,k=!0);e.resetCounter>u&&(k=!0);if(k){var G;e.conversion.endFrame=i.frame,e.conversion.endPercent=p&&null!=(G=p.percent)?G:0,e.conversion=null,e.move=null}return k}(e,r,n,t,this.conversions);a&&this.emit("CONVERSION",{combo:(0,i.A)(this.conversions),settings:this.settings})}})}fetch(){return this._populateConversionTypes(),this.conversions}_populateConversionTypes(){const t=(0,M.A)(this.conversions,t=>"unknown"===t.openingType),e=(0,v.A)(t,"startFrame");(0,k.A)(e,t=>(0,r.A)(t,[0,"startFrame"])).forEach(t=>{const e=t.length>=2;t.forEach(t=>{if(this.metadata.lastEndFrameByOppIdx[t.playerIndex]=t.endFrame,e)return void(t.openingType="trade");const n=(0,i.A)(t.moves),s=this.metadata.lastEndFrameByOppIdx[n?n.playerIndex:t.playerIndex],r=s&&s>t.startFrame;t.openingType=r?"counter-attack":"neutral-win"})})}}!function(t){t[t.MESSAGE_SIZES=53]="MESSAGE_SIZES",t[t.GAME_START=54]="GAME_START",t[t.PRE_FRAME_UPDATE=55]="PRE_FRAME_UPDATE",t[t.POST_FRAME_UPDATE=56]="POST_FRAME_UPDATE",t[t.GAME_END=57]="GAME_END",t[t.ITEM_UPDATE=59]="ITEM_UPDATE",t[t.FRAME_BOOKEND=60]="FRAME_BOOKEND"}(N||(N={})),function(t){t[t.VS=2]="VS",t[t.ONLINE=8]="ONLINE"}(O||(O={})),function(t){t[t.FIRST=-123]="FIRST",t[t.FIRST_PLAYABLE=-39]="FIRST_PLAYABLE"}(L||(L={})),function(t){t[t.DZ=0]="DZ",t[t.NE=1]="NE",t[t.SE=2]="SE",t[t.SW=3]="SW",t[t.NW=4]="NW",t[t.N=5]="N",t[t.E=6]="E",t[t.S=7]="S",t[t.W=8]="W"}(P||(P={}));class b{constructor(){this.state=new Map,this.playerPermutations=new Array}setup(t){this.state=new Map,this.playerPermutations=p(t),this.playerPermutations.forEach(t=>{const e={playerIndex:t.playerIndex,opponentIndex:t.opponentIndex,inputCount:0,joystickInputCount:0,cstickInputCount:0,buttonInputCount:0,triggerInputCount:0};this.state.set(t,e)})}processFrame(t,e){this.playerPermutations.forEach(n=>{const s=this.state.get(n);s&&function(t,e,n,s){const r=s.players[n.playerIndex].pre,a=r.frame,o=a-1,i=t[o]?t[o].players[n.playerIndex].pre:null;if(a<L.FIRST_PLAYABLE||!i)return;const l=~i.physicalButtons,c=r.physicalButtons,u=function(t){let e,n=t;for(e=0;n;e+=1)n&=n-1;return e}(l&c&4095);e.inputCount+=u,e.buttonInputCount+=u;const h=w(i.joystickX,i.joystickY),p=w(r.joystickX,r.joystickY);h!==p&&p!==P.DZ&&(e.inputCount+=1,e.joystickInputCount+=1);const A=w(i.cStickX,i.cStickY),m=w(r.cStickX,r.cStickY);A!==m&&m!==P.DZ&&(e.inputCount+=1,e.cstickInputCount+=1);i.physicalLTrigger<.3&&r.physicalLTrigger>=.3&&(e.inputCount+=1,e.triggerInputCount+=1);i.physicalRTrigger<.3&&r.physicalRTrigger>=.3&&(e.inputCount+=1,e.triggerInputCount+=1)}(e,s,n,t)})}fetch(){return Array.from(this.state.values())}}function w(t,e){let n=P.DZ;return t>=.2875&&e>=.2875?n=P.NE:t>=.2875&&e<=-.2875?n=P.SE:t<=-.2875&&e<=-.2875?n=P.SW:t<=-.2875&&e>=.2875?n=P.NW:e>=.2875?n=P.N:t>=.2875?n=P.E:e<=-.2875?n=P.S:t<=-.2875&&(n=P.W),n}var x=n(5216),U=n(9048),B=n(8900),W=n(7108);function H(t,e){return{count:t,total:e,ratio:e?t/e:null}}function K(t,e,n,s){const a=(0,r.A)(t,[e,s])||[],o=(0,U.A)(n.map(e=>(0,r.A)(t,[e,s])||[]));return H(a.length,a.length+o.length)}function Y(t,e,n){const s=(0,r.A)(t,[e,"trade"])||[],a=(0,U.A)(n.map(e=>(0,r.A)(t,[e,"trade"])||[])),o=[];return(0,B.A)(s,a).forEach(t=>{const e=(0,W.A)(t),n=(0,i.A)(t);if(e&&n){const t=e.currentPercent-e.startPercent,s=n.currentPercent-n.startPercent;(e.didKill&&!n.didKill||t>s)&&o.push(e)}}),H(o.length,s.length)}const z={processOnTheFly:!1};class X{constructor(t){this.options=void 0,this.lastProcessedFrame=null,this.frames={},this.players=[],this.allComputers=new Array,this.options=Object.assign({},z,t)}setup(t){this.frames={},this.players=t.players.map(t=>t.playerIndex),this.allComputers.forEach(e=>e.setup(t))}register(){this.allComputers.push(...arguments)}process(){if(0===this.players.length)return;let t=null!==this.lastProcessedFrame?this.lastProcessedFrame+1:L.FIRST;for(;this.frames[t];){const e=this.frames[t];if(!j(this.players,e))return;this.allComputers.forEach(t=>t.processFrame(e,this.frames)),this.lastProcessedFrame=t,t++}}addFrame(t){this.frames[t.frame]=t,this.options.processOnTheFly&&this.process()}}function j(t,e){if(!e)return!1;for(const n of t){if(!(0,r.A)(e,["players",n,"post"]))return!1}return!0}class J{constructor(){this.state=new Map,this.playerPermutations=new Array,this.stocks=new Array}setup(t){this.state=new Map,this.playerPermutations=p(t),this.stocks=[],this.playerPermutations.forEach(t=>{this.state.set(t,{stock:null})})}processFrame(t,e){this.playerPermutations.forEach(n=>{const s=this.state.get(n);s&&function(t,e,n,s,r){const a=s.players[n.playerIndex].post,o=a.frame,i=o-1,l=t[i]?t[i].players[n.playerIndex].post:null;if(e.stock)if(l&&A(a,l)){var c;e.stock.endFrame=a.frame,e.stock.endPercent=null!=(c=l.percent)?c:0,e.stock.deathAnimation=a.actionStateId,e.stock=null}else{var u;e.stock.currentPercent=null!=(u=a.percent)?u:0}else{if(E(a.actionStateId))return;e.stock={playerIndex:n.playerIndex,startFrame:o,endFrame:null,startPercent:0,endPercent:null,currentPercent:0,count:a.stocksRemaining,deathAnimation:null},r.push(e.stock)}}(e,s,n,t,this.stocks)})}fetch(){return this.stocks}}var Z=n(9493),V=n.n(Z);class Q{constructor(){this.rollbackFrames={},this.rollbackFrameCount=0,this.rollbackPlayerIdx=null,this.lastFrameWasRollback=!1,this.currentRollbackLength=0,this.rollbackLengths=[]}checkIfRollbackFrame(t,e){if(null===this.rollbackPlayerIdx)this.rollbackPlayerIdx=e;else if(this.rollbackPlayerIdx!==e)return;return t?(this.rollbackFrames[t.frame]?this.rollbackFrames[t.frame].push(t):this.rollbackFrames[t.frame]=[t],this.rollbackFrameCount++,this.currentRollbackLength++,this.lastFrameWasRollback=!0):this.lastFrameWasRollback&&(this.rollbackLengths.push(this.currentRollbackLength),this.currentRollbackLength=0,this.lastFrameWasRollback=!1),this.lastFrameWasRollback}getFrames(){return this.rollbackFrames}getCount(){return this.rollbackFrameCount}getLengths(){return this.rollbackLengths}}var q;!function(t){t.SETTINGS="settings",t.END="end",t.FRAME="frame",t.FINALIZED_FRAME="finalized-frame",t.ROLLBACK_FRAME="rollback-frame"}(q||(q={}));const $={strict:!1};class tt extends F.EventEmitter{constructor(t){super(),this.frames={},this.rollbackCounter=new Q,this.settings=null,this.gameEnd=null,this.latestFrameIndex=null,this.settingsComplete=!1,this.lastFinalizedFrame=L.FIRST-1,this.options=void 0,this.options=Object.assign({},$,t)}handleCommand(t,e){switch(t){case N.GAME_START:this._handleGameStart(e);break;case N.POST_FRAME_UPDATE:this._handlePostFrameUpdate(e),this._handleFrameUpdate(t,e);break;case N.PRE_FRAME_UPDATE:this._handleFrameUpdate(t,e);break;case N.ITEM_UPDATE:this._handleItemUpdate(e);break;case N.FRAME_BOOKEND:this._handleFrameBookend(e);break;case N.GAME_END:this._handleGameEnd(e)}}reset(){this.frames={},this.settings=null,this.gameEnd=null,this.latestFrameIndex=null,this.settingsComplete=!1,this.lastFinalizedFrame=L.FIRST-1}getLatestFrameNumber(){var t;return null!=(t=this.latestFrameIndex)?t:L.FIRST-1}getPlayableFrameCount(){return null===this.latestFrameIndex||this.latestFrameIndex<L.FIRST_PLAYABLE?0:this.latestFrameIndex-L.FIRST_PLAYABLE}getLatestFrame(){const t=this.getFrames(),e=null!==this.latestFrameIndex?this.latestFrameIndex:L.FIRST,n=this.gameEnd?e:e-1;return(0,r.A)(t,n)||null}getSettings(){return this.settingsComplete?this.settings:null}getGameEnd(){return this.gameEnd}getFrames(){return this.frames}getRollbackFrames(){return{frames:this.rollbackCounter.getFrames(),count:this.rollbackCounter.getCount(),lengths:this.rollbackCounter.getLengths()}}getFrame(t){return this.frames[t]||null}_handleGameEnd(t){null!==this.latestFrameIndex&&this.latestFrameIndex!==this.lastFinalizedFrame&&this._finalizeFrames(this.latestFrameIndex),this.gameEnd=t,this.emit(q.END,this.gameEnd)}_handleGameStart(t){this.settings=t;const e=t.players;this.settings.players=e.filter(t=>3!==t.type),t.slpVersion&&V().gte(t.slpVersion,"1.6.0")&&this._completeSettings()}_handlePostFrameUpdate(t){if(!this.settingsComplete){if(t.frame<=L.FIRST){const e=t.playerIndex,n=(0,l.A)(this.settings.players,"playerIndex");switch(t.internalCharacterId){case 7:n[e].characterId=19;break;case 19:n[e].characterId=18}}t.frame>L.FIRST&&this._completeSettings()}}_handleFrameUpdate(t,e){const n=t===N.PRE_FRAME_UPDATE?"pre":"post",s=e.isFollower?"followers":"players",r=e.frame;if(this.latestFrameIndex=r,"pre"===n&&!e.isFollower){const t=this.frames[r];this.rollbackCounter.checkIfRollbackFrame(t,e.playerIndex)&&this.emit(q.ROLLBACK_FRAME,t)}(0,a.A)(this.frames,[r,s,e.playerIndex,n],e),(0,a.A)(this.frames,[r,"frame"],r);const o=this.getSettings();!o||o.slpVersion&&!V().lte(o.slpVersion,"2.2.0")?(0,a.A)(this.frames,[r,"isTransferComplete"],!1):(this.emit(q.FRAME,this.frames[r]),this._finalizeFrames(r-1))}_handleItemUpdate(t){var e,n;const s=t.frame,r=null!=(e=null==(n=this.frames[s])?void 0:n.items)?e:[];r.push(t),(0,a.A)(this.frames,[s,"items"],r)}_handleFrameBookend(t){const e=t.latestFinalizedFrame,n=t.frame;(0,a.A)(this.frames,[n,"isTransferComplete"],!0),this.emit(q.FRAME,this.frames[n]);if(this.settings.gameMode===O.ONLINE&&e>=L.FIRST){if(this.options.strict&&e<n-7)throw new Error("latestFinalizedFrame should be within ".concat(7," frames of ").concat(n));this._finalizeFrames(e)}else this._finalizeFrames(n-7)}_finalizeFrames(t){for(;this.lastFinalizedFrame<t;){const e=this.lastFinalizedFrame+1,n=this.getFrame(e);if(this.options.strict)for(const s of this.settings.players){const r=n.players[s.playerIndex];if(this.settings.players.length>2&&!r)continue;const{pre:a,post:o}=r;if(!a||!o){const n=a?"pre":"post";throw new Error("Could not finalize frame ".concat(e," of ").concat(t,": missing ").concat(n,"-frame update for player ").concat(s.playerIndex))}}this.emit(q.FINALIZED_FRAME,n),this.lastFinalizedFrame=e}}_completeSettings(){this.settingsComplete||(this.settingsComplete=!0,this.emit(q.SETTINGS,this.settings))}}var et,nt=n(3929),st=n(5169),rt=n.n(st),at=n(1350);function ot(t){const e=(0,at.A)(t,t=>{return(e=t.charCodeAt(0))>65280&&e<65375?e-65280+32:12288===e?32:8217===e?39:8221===e?34:e;var e});return String.fromCharCode(...e)}function it(t,e,n,s,r){if(t.source===et.BUFFER){for(let a=0;a<s;a++)e[n+a]=t.buffer[r+a];return e.length}throw new Error("Source type not supported")}function lt(t){if(t.source===et.BUFFER)return t.buffer.length;throw new Error("Source type not supported")}function ct(t){const e=function(t){if(t.source===et.BUFFER)return{source:t.source,buffer:t.buffer};throw new Error("Source type not supported")}(t),n=function(t){const e=ut.from(new Uint8Array(1));if(it(t,e,0,e.length,0),54===e[0])return 0;if(e[0]!=="{".charCodeAt(0))return 0;return 15}(e),s=function(t,e){const n=lt(t);if(0===e)return n;const s=new Uint8Array(4);it(t,s,0,s.length,e-4);const r=s[0]<<24|s[1]<<16|s[2]<<8|s[3];if(r>0)return r;return n-e}(e,n),r=n+s+10,a=function(t,e){const n=lt(t);return n-e-1}(e,r),o=function(t,e){const n={};if(0===e)return n[54]=320,n[55]=6,n[56]=70,n[57]=1,n;const s=new Uint8Array(2);if(it(t,s,0,s.length,e),s[0]!==N.MESSAGE_SIZES)return{};const r=s[1];n[53]=r;const a=new Uint8Array(r-1);it(t,a,0,a.length,e+2);for(let o=0;o<r-1;o+=3){n[a[o]]=a[o+1]<<8|a[o+2]}return n}(e,n);return{ref:e,rawDataPosition:n,rawDataLength:s,metadataPosition:r,metadataLength:a,messageSizes:o}}!function(t){t.BUFFER="buffer",t.FILE="file"}(et||(et={}));var ut=n(5055).Buffer;function ht(t,e){const n=new DataView(e.buffer);switch(t){case N.GAME_START:const t=t=>{const s=8*t,r=_t(n,321+s);let a="None";r!==_t(n,325+s)?a="Mixed":1===r?a="UCF":2===r&&(a="Dween");const o=353+16*t,i=e.slice(o,o+16),l=rt().decode(i,"Shift_JIS").split("\0").shift(),c=l?ot(l):"",u=421+31*t,h=e.slice(u,u+31),p=rt().decode(h,"Shift_JIS").split("\0").shift(),A=p?ot(p):"",m=545+10*t,d=e.slice(m,m+10),_=rt().decode(d,"Shift_JIS").split("\0").shift(),E=_?ot(_):"",f=36*t;return{playerIndex:t,port:t+1,characterId:ft(n,101+f),characterColor:ft(n,104+f),startStocks:ft(n,103+f),type:ft(n,102+f),teamId:ft(n,110+f),controllerFix:a,nametag:c,displayName:A,connectCode:E}};return{slpVersion:"".concat(ft(n,1),".").concat(ft(n,2),".").concat(ft(n,3)),isTeams:Tt(n,13),isPAL:Tt(n,417),stageId:Et(n,19),players:[0,1,2,3].map(t),scene:ft(n,419),gameMode:ft(n,420)};case N.PRE_FRAME_UPDATE:return{frame:mt(n,1),playerIndex:ft(n,5),isFollower:Tt(n,6),seed:_t(n,7),actionStateId:Et(n,11),positionX:At(n,13),positionY:At(n,17),facingDirection:At(n,21),joystickX:At(n,25),joystickY:At(n,29),cStickX:At(n,33),cStickY:At(n,37),trigger:At(n,41),buttons:_t(n,45),physicalButtons:Et(n,49),physicalLTrigger:At(n,51),physicalRTrigger:At(n,55),percent:At(n,60)};case N.POST_FRAME_UPDATE:const s={airX:At(n,53),y:At(n,57),attackX:At(n,61),attackY:At(n,65),groundX:At(n,69)};return{frame:mt(n,1),playerIndex:ft(n,5),isFollower:Tt(n,6),internalCharacterId:ft(n,7),actionStateId:Et(n,8),positionX:At(n,10),positionY:At(n,14),facingDirection:At(n,18),percent:At(n,22),shieldSize:At(n,26),lastAttackLanded:ft(n,30),currentComboCount:ft(n,31),lastHitBy:ft(n,32),stocksRemaining:ft(n,33),actionStateCounter:At(n,34),miscActionState:At(n,43),isAirborne:Tt(n,47),lastGroundId:Et(n,48),jumpsRemaining:ft(n,50),lCancelStatus:ft(n,51),hurtboxCollisionState:ft(n,52),selfInducedSpeeds:s};case N.ITEM_UPDATE:return{frame:mt(n,1),typeId:Et(n,5),state:ft(n,7),facingDirection:At(n,8),velocityX:At(n,12),velocityY:At(n,16),positionX:At(n,20),positionY:At(n,24),damageTaken:Et(n,28),expirationTimer:At(n,30),spawnId:_t(n,34),missileType:ft(n,38),turnipFace:ft(n,39),chargeShotLaunched:ft(n,40),chargePower:ft(n,41),owner:dt(n,42)};case N.FRAME_BOOKEND:return{frame:mt(n,1),latestFinalizedFrame:mt(n,5)};case N.GAME_END:return{gameEndMethod:ft(n,1),lrasInitiatorIndex:dt(n,2)};default:return null}}function pt(t,e,n){return e+n<=t.byteLength}function At(t,e){return pt(t,e,4)?t.getFloat32(e):null}function mt(t,e){return pt(t,e,4)?t.getInt32(e):null}function dt(t,e){return pt(t,e,1)?t.getInt8(e):null}function _t(t,e){return pt(t,e,4)?t.getUint32(e):null}function Et(t,e){return pt(t,e,2)?t.getUint16(e):null}function ft(t,e){return pt(t,e,1)?t.getUint8(e):null}function Tt(t,e){return pt(t,e,1)?!!t.getUint8(e):null}var Ct=n(5055).Buffer;class Rt{constructor(t,e){this.input=void 0,this.metadata=null,this.finalStats=null,this.parser=void 0,this.readPosition=null,this.actionsComputer=new C,this.conversionComputer=new G,this.comboComputer=new S,this.stockComputer=new J,this.inputComputer=new b,this.statsComputer=void 0,this.input={source:et.BUFFER,buffer:Ct.from(t.buffer)},this.statsComputer=new X(e),this.statsComputer.register(this.actionsComputer,this.comboComputer,this.conversionComputer,this.inputComputer,this.stockComputer),this.parser=new tt,this.parser.on(q.SETTINGS,t=>{this.statsComputer.setup(t)}),this.parser.on(q.FINALIZED_FRAME,t=>{this.statsComputer.addFrame(t)})}_process(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(null!==this.parser.getGameEnd())return;const e=ct(this.input);this.readPosition=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s=t.ref;let r=null!==n&&n>0?n:t.rawDataPosition;const a=t.rawDataPosition+t.rawDataLength,o=(0,x.A)(t.messageSizes,t=>new Uint8Array(t+1)),i=new Uint8Array(1);for(;r<a;){it(s,i,0,1,r);const t=i[0],n=o[t];if(void 0===n)return r;if(n.length>a-r)return r;if(it(s,n,0,n.length,r),e(t,ht(t,n)))break;r+=n.length}return r}(e,(e,n)=>!!n&&(this.parser.handleCommand(e,n),t&&null!==this.parser.getSettings()),this.readPosition)}getSettings(){return this._process(!0),this.parser.getSettings()}getLatestFrame(){return this._process(),this.parser.getLatestFrame()}getGameEnd(){return this._process(),this.parser.getGameEnd()}getStats(){if(this.finalStats)return this.finalStats;this._process();const t=this.parser.getSettings();if(null===t)return null;this.statsComputer.process();const e=this.inputComputer.fetch(),n=this.stockComputer.fetch(),s=this.conversionComputer.fetch(),a=this.parser.getPlayableFrameCount(),o=function(t){let{settings:e,inputs:n,conversions:s,playableFrameCount:a}=t;const o=(0,l.A)(n,"playerIndex"),i=s,c=(0,v.A)(s,t=>{var e;return null==(e=t.moves[0])?void 0:e.playerIndex}),u=(0,x.A)(c,t=>(0,v.A)(t,"openingType")),h=a/3600;return e.players.map(t=>{const n=t.playerIndex,s=(0,r.A)(o,n)||{},a={buttons:(0,r.A)(s,"buttonInputCount"),triggers:(0,r.A)(s,"triggerInputCount"),cstick:(0,r.A)(s,"cstickInputCount"),joystick:(0,r.A)(s,"joystickInputCount"),total:(0,r.A)(s,"inputCount")};let l=0,c=0;const p=e.players.filter(s=>s.playerIndex!==n&&(!e.isTeams||s.teamId!==t.teamId)).map(t=>t.playerIndex);let A=0,m=0;return i.filter(t=>t.playerIndex!==n).forEach(t=>{l++,t.didKill&&t.lastHitBy===n&&(m+=1),t.moves.length>1&&t.moves[0].playerIndex===n&&c++,t.moves.forEach(t=>{t.playerIndex===n&&(A+=t.damage)})}),{playerIndex:n,inputCounts:a,conversionCount:l,totalDamage:A,killCount:m,successfulConversions:H(c,l),inputsPerMinute:H(a.total,h),digitalInputsPerMinute:H(a.buttons,h),openingsPerKill:H(l,m),damagePerOpening:H(A,l),neutralWinRatio:K(u,n,p,"neutral-win"),counterHitRatio:K(u,n,p,"counter-attack"),beneficialTradeRatio:Y(u,n,p)}})}({settings:t,inputs:e,conversions:s,playableFrameCount:a}),i={lastFrame:this.parser.getLatestFrameNumber(),playableFrameCount:a,stocks:n,conversions:s,combos:this.comboComputer.fetch(),actionCounts:this.actionsComputer.fetch(),overall:o,gameComplete:null!==this.parser.getGameEnd()};return null!==this.parser.getGameEnd()&&(this.finalStats=i),i}getMetadata(){if(this.metadata)return this.metadata;const t=ct(this.input);return this.metadata=function(t){if(t.metadataLength<=0)return null;const e=new Uint8Array(t.metadataLength);it(t.ref,e,0,e.length,t.metadataPosition);let n=null;try{n=(0,nt.D4)(e)}catch(s){}return n}(t),this.metadata}}const It=[2,3,8,28,31,32],gt=new FileReaderSync,Dt=t=>{try{const e=gt.readAsArrayBuffer(t),n=new Rt(new Uint8Array(e)),s=n.getMetadata();if((t=>{var e,n,s,r,a,o,i,l;return!t||!t.lastFrame||(t.lastFrame<2400||(!t.startAt.startsWith("2025")||(2!==Object.keys(t.players).length||(null===(e=t.players[0])||void 0===e||null===(n=e.names)||void 0===n||!n.netplay||(null===(s=t.players[0])||void 0===s||null===(r=s.names)||void 0===r||!r.code||(null===(a=t.players[1])||void 0===a||null===(o=a.names)||void 0===o||!o.netplay||(null===(i=t.players[1])||void 0===i||null===(l=i.names)||void 0===l||!l.code||(Object.keys(t.players[0].characters)[0]>26||Object.keys(t.players[1].characters)[0]>26))))))))})(s))return null;const r=n.getStats(),a=n.getSettings();return n.input={},r.settings=a,((t,e)=>{let{stocks:n,inputs:s}=t;if(e.is_teams)return!0;if(!It.includes(e.stageId))return!0;if(![2,8].includes(e.gameMode))return!0;const r=n.filter(t=>0===t.playerIndex&&t.endFrame).length,a=n.filter(t=>1===t.playerIndex&&t.endFrame).length;return r<=2&&a<=2})(r,a)?null:{metadata:s,stats:r}}catch(e){return console.log("SLIPPI-JS ERROR:",e),null}};self.onmessage=async t=>{let{data:e}=t;const n=e.file,s=Dt(n);self.postMessage(s)}},7714:()=>{}}]);
//# sourceMappingURL=782.bd0f5242.chunk.js.map